<?xml version="1.0"?>

<Console>
  <Enabled>false</Enabled>
  <Verbose>true</Verbose>
</Console>

<include filename="defines.xml"/>

<!-- Define Performers -->

<Performer>
  <Name>PlatoMain</Name>
  <Code>PlatoMain</Code>
  <PerformerID>0</PerformerID>
</Performer>

<Performer>
  <PerformerID>1</PerformerID>
  <Name>plato_analyze_1_0</Name>
</Performer>

<Performer>
  <PerformerID>2</PerformerID>
  <Name>plato_analyze_1_1</Name>
</Performer>

<Performer>
  <PerformerID>3</PerformerID>
  <Name>plato_analyze_1_2</Name>
</Performer>

<Performer>
  <PerformerID>4</PerformerID>
  <For var="PerformerIndex" in="Performers">
    <Name>plato_services_{PerformerIndex}</Name>
    <Code>PlatoServices</Code>
  </For>
</Performer>

<!-- Define SharedData -->

<For var="PerformerIndex" in="Performers">
  <SharedData>
    <Name>design_parameters_{PerformerIndex}</Name>
    <Type>Scalar</Type>
    <Layout>Global</Layout>
    <Size>{NumParameters}</Size>
    <OwnerName>PlatoMain</OwnerName>
    <UserName>PlatoMain</UserName>
    <UserName>plato_analyze_1_{PerformerIndex}</UserName>
  </SharedData>
</For>

<For var="PerformerIndex" in="Performers">
  <SharedData>
    <Name>criterion_compliance_{PerformerIndex}</Name>
    <Type>Scalar</Type>
    <Layout>Global</Layout>
    <Size>1</Size>
    <OwnerName>plato_analyze_1_{PerformerIndex}</OwnerName>
    <UserName>PlatoMain</UserName>
  </SharedData>
</For>

<For var="PerformerIndex" in="Performers">
  <SharedData>
    <Name>criterion_volume_{PerformerIndex}</Name>
    <Type>Scalar</Type>
    <Layout>Global</Layout>
    <Size>1</Size>
    <OwnerName>plato_analyze_1_{PerformerIndex}</OwnerName>
    <UserName>PlatoMain</UserName>
  </SharedData>
</For>

<Stage>
  <Name>Initialize Meshes</Name>
  
  <For var="PerformerIndex" in="Performers">
    <Input>
      <SharedDataName>design_parameters_{PerformerIndex}</SharedDataName>
    </Input>
  </For>

  <Operation>
    <For var="PerformerIndex" in="Performers">

      <Operation>
        <Name>update_geometry_on_change_{PerformerIndex}</Name>
        <PerformerName>plato_services_{PerformerIndex}</PerformerName>
        <Input>
          <ArgumentName>Parameters_{PerformerIndex}</ArgumentName>
          <SharedDataName>design_parameters_{PerformerIndex}</SharedDataName>
        </Input>
      </Operation>

    </For>
  </Operation>

  <Operation>
    <For var="PerformerIndex" in="Performers">

      <Operation>
        <Name>Reinitialize on Change</Name>
        <PerformerName>plato_analyze_1_{PerformerIndex}</PerformerName>
        <Input>
          <ArgumentName>Parameters</ArgumentName>
          <SharedDataName>design_parameters_{PerformerIndex}</SharedDataName>
        </Input>
      </Operation>

    </For>
  </Operation>

</Stage>

<Stage>
  <Name>Compliance Objective</Name>

  <Operation>
    <For var="PerformerIndex" in="Performers">

      <Operation>
        <Name>Compute Compliance Criterion</Name>
        <PerformerName>plato_analyze_1_{PerformerIndex}</PerformerName>
        <Output>
          <ArgumentName>Compliance Value</ArgumentName>
          <SharedDataName>criterion_compliance_{PerformerIndex}</SharedDataName>
        </Output>
      </Operation>

    </For>
  </Operation>

  <For var="PerformerIndex" in="Performers">
    <Output>
      <SharedDataName>criterion_compliance_{PerformerIndex}</SharedDataName>
    </Output>
  </For>

</Stage>

<Stage>
  <Name>Volume Objective</Name>
  
  <Operation>
    <For var="PerformerIndex" in="Performers">

      <Operation>
        <Name>Compute Volume Criterion</Name>
        <PerformerName>plato_analyze_1_{PerformerIndex}</PerformerName>
        <Output>
          <ArgumentName>Volume Value</ArgumentName>
          <SharedDataName>criterion_volume_{PerformerIndex}</SharedDataName>
        </Output>
      </Operation>

    </For>
  </Operation>

  <For var="PerformerIndex" in="Performers">
    <Output>
      <SharedDataName>criterion_volume_{PerformerIndex}</SharedDataName>
    </Output>
  </For>

</Stage>

<DakotaDriver>

  <Stage>

    <StageTag>initialize</StageTag>
    <StageName>Initialize Meshes</StageName>

    <For var="PerformerIndex" in="Performers">
      <Input>
        <Tag>continuous</Tag>
        <SharedDataName>design_parameters_{PerformerIndex}</SharedDataName>
      </Input>
    </For>

  </Stage>

  <Stage>

    <StageTag>criterion_value_0</StageTag>
    <StageName>Compliance Objective</StageName>

    <For var="PerformerIndex" in="Performers">
      <Output>
        <SharedDataName>criterion_compliance_{PerformerIndex}</SharedDataName>
      </Output>
    </For>

  </Stage>

  <Stage>

    <StageTag>criterion_value_1</StageTag>
    <StageName>Volume Objective</StageName>

    <For var="PerformerIndex" in="Performers">
      <Output>
        <SharedDataName>criterion_volume_{PerformerIndex}</SharedDataName>
      </Output>
    </For>

  </Stage>

</DakotaDriver>
